<html>
    <head>
    <title>Universal Coordinate Pin - App</title>
        <!address locator>
        <!importing jquery and js for google maps (can be found on ajax.google.com)>
        <script type="text/javascript" src="js/jquery-1.9.1.js"></script>
        
        <script type="text/javascript" src="http://maps.google.com/maps/api/js?key=AIzaSyCEqoC5yQIIBXbNVxsuRe787A29ZC32CVA&callback=initMap"></script>
        
        <style type="text/css">
            
            #city_country {
                padding: 1px 4px;
            }
           
           #button {
                font-size: 20px;
                border: none;
                color: #FFFFFF;
                text-align: center;
                display: inline-block;
                background-color: #000000;
                opacity: 0.8;
            }
            
            #maparea {
                width: 80%;
                height: 100%;
                right: 0%;
                top: 0%;
                position: absolute;
                opacity: 1;
                z-index: 1;
            }
            #infoPanel {
                width: 20%;
                height: 100%;
                left: 0%;
                top: 0%;
                font-size: 20px;
                float: left;
                position: absolute;
                background: #000000;
                color: #FFFFFF;
                opacity: 0.8;
                font-family: Sans-serif;
            }
        </style>
        <script type="text/javascript">
            $(window).load(function(){
                           var geocoder;
                           var map;
                           var marker;
                           
                           h2d = function(d)
                           {
                           return parseInt(d, 36);
                           }
                           
                           back = function() {
                           
                           var rev1 = document.getElementById('ipcode1').value;
                           var rev2 = document.getElementById('ipcode2').value;
                           document.getElementById('copo').innerHTML = [
                                                                        (h2d(rev1)/100)-180,
                                                                        (h2d(rev2)/100)-90
                                                                        ].join(', ');
                           }
                           
                           codeAddress = function () {
                           geocoder = new google.maps.Geocoder();
                           
                           var address = document.getElementById('city_country').value;
                           geocoder.geocode( { 'address': address}, function(results, status) {
                                            if (status == google.maps.GeocoderStatus.OK) {
                                            map = new google.maps.Map(document.getElementById('maparea'), {
                                                                      zoom: 16,
                                                                      streetViewControl: false,
                                                                      mapTypeControlOptions: {
                                                                      style: google.maps.MapTypeControlStyle.HORIZONTAL_BAR,
                                                                      mapTypeIds:[google.maps.MapTypeId.HYBRID, google.maps.MapTypeId.ROADMAP]
                                                                      },
                                                                      center: results[0].geometry.location,
                                                                      mapTypeId: google.maps.MapTypeId.ROADMAP
                                                                      });
                                            map.setCenter(results[0].geometry.location);
                                            marker = new google.maps.Marker({
                                                                            map: map,
                                                                            position: results[0].geometry.location,
                                                                            draggable: true,
                                                                            title: 'drag'
                                                                            });
                                            updateMarkerPosition(results[0].geometry.location);
                                            updatetscode(results[0].geometry.location);
                                            geocodePosition(results[0].geometry.location);
                                            
                                            google.maps.event.addListener(marker, 'dragstart', function() {
                                                                          updateMarkerAddress('Finding');
                                                                          });
                                            
                                            google.maps.event.addListener(marker, 'drag', function() {
                                                                          updateMarkerStatus('Moving');
                                                                          updateMarkerPosition(marker.getPosition());
                                                                          updatetscode(marker.getPosition());
                                                                          });
                                            
                                            google.maps.event.addListener(marker, 'dragend', function() {
                                                                          updateMarkerStatus('Stable');
                                                                          geocodePosition(marker.getPosition());
                                                                          map.panTo(marker.getPosition());
                                                                          });
                                            
                                            google.maps.event.addListener(map, 'click', function(e) {
                                                                          updateMarkerPosition(e.latLng);
                                                                          updatetscode(e.latLng);
                                                                          geocodePosition(marker.getPosition());
                                                                          marker.setPosition(e.latLng);
                                                                          map.panTo(marker.getPosition());
                                                                          });
                                            
                                            } else {
                                            alert('Geocode was not successful for the following reason: ' + status);
                                            }
                                            });
                           }
                           
                           function geocodePosition(pos) {
                           geocoder.geocode({
                                            latLng: pos
                                            }, function(responses) {
                                            if (responses && responses.length > 0) {
                                            updateMarkerAddress(responses[0].formatted_address);
                                            } else {
                                            updateMarkerAddress('Cannot determine address at this location.');
                                            }
                                            });
                           }
                           
                           function d2h(d)
                           {
                           return (+d).toString(36).toUpperCase();
                           }
                           
                           function updateMarkerStatus(str) {
                           document.getElementById('markerStatus').innerHTML = str;
                           }
                           
                           function updateMarkerPosition(latLng) {
                           
                           document.getElementById('info').innerHTML = [
                                                                        latLng.lat(),
                                                                        latLng.lng()
                                                                        ].join(', ');
                           }
                           
                           
                           
                           function updatetscode(latLng) {
                           
                           var latitude = latLng.lat();
                           var longitude = latLng.lng();
                           var lati = Math.round(latitude*100)+18000;
                           var long = Math.round(longitude*100)+9000;
                           
                           document.getElementById('tscode').innerHTML = [
                                                                        d2h(lati),
                                                                        d2h(long)
                                                                        ].join('- ');
                           
                           }
                           
                           function updateMarkerAddress(str) {
                           document.getElementById('address').innerHTML = str;
                           }
                           });
                        
                        
                    </script>
    
    </head>
<body style="background-color:#666666;">
    
    <div id="maparea" align="center">
    </div>
    <div id="infoPanel" align="center">
        <div id="panel" align="center"><br/>
            <input style="font-size: 15px; " id="city_country" type="textbox" value="Jaipur">
            <input type="button" value="Go!" onclick="codeAddress()" id="button">
            <br/>
            <br/>
        </div>
        
        <br/><b>Marker status:</b>
        <div id="markerStatus"><br/>
        </div>
        <b>Current position:</b>
        <div id="info">Click on Go!
        </div>
        <b>UCP Code:</b>
        <div id="tscode">Click on Go!
        </div>
        <b>Closest matching address:</b>
        <div id="address">Click on Go!
        </div><br/>____________<br/><br/>
        <div id="coderev" align="center">
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <input style="font-size: 15px; width: 50px;" id="ipcode1" type="textbox" value="FYR">
            <input style="font-size: 15px; width: 50px;" id="ipcode2" type="textbox" value="CSJ">
            <input type="button" value="Convert Back" onclick="back()" id="button">
            <br/>
            <br/>
        </div>
        <b>Corresponding Position:</b>
        <div id="copo">26.9124336, 75.78727090000007</div>
        <br/>
    </div>
</body>
</html>
