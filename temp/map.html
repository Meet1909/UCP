<html>
    <head>
        <title>Universal Coordinate Pin - App</title>
    
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
    
        <!--
         address locator
         importing jquery and js for google maps (can be found on ajax.google.com)-->
    
        <script type="text/javascript" src="./js/jquery-1.9.1.js"></script>
    
        <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCEqoC5yQIIBXbNVxsuRe787A29ZC32CVA&callback=initMap" async defer></script>
        <script type="text/javascript" src="./js/main.js"></script>
        
        <script type="text/javascript">
            $(window).load(function(){
                           var geocoder;
                           var map;
                           var marker;
                           
                           h2d = function(d)
                           {
                           return parseInt(d, 36);
                           }
                           
                           back = function() {
                           
                           var rev1 = document.getElementById('ipcode1').value;
                           var rev2 = document.getElementById('ipcode2').value;
                           document.getElementById('copo').innerHTML = [
                                                                        h2d(rev1)/100,
                                                                        h2d(rev2)/100
                                                                        ].join(', ');
                           }
                           
                           codeAddress = function () {
                           geocoder = new google.maps.Geocoder();
                           
                           var address = document.getElementById('city_country').value;
                           geocoder.geocode( { 'address': address}, function(results, status) {
                                            if (status == google.maps.GeocoderStatus.OK) {
                                            map = new google.maps.Map(document.getElementById('maparea'), {
                                                                      zoom: 16,
                                                                      streetViewControl: false,
                                                                      mapTypeControlOptions: {
                                                                      style: google.maps.MapTypeControlStyle.HORIZONTAL_BAR,
                                                                      mapTypeIds:[google.maps.MapTypeId.HYBRID, google.maps.MapTypeId.ROADMAP]
                                                                      },
                                                                      center: results[0].geometry.location,
                                                                      mapTypeId: google.maps.MapTypeId.ROADMAP
                                                                      });
                                            map.setCenter(results[0].geometry.location);
                                            marker = new google.maps.Marker({
                                                                            map: map,
                                                                            position: results[0].geometry.location,
                                                                            draggable: true,
                                                                            title: 'drag'
                                                                            });
                                            updateMarkerPosition(results[0].geometry.location);
                                            updatetscode(results[0].geometry.location);
                                            geocodePosition(results[0].geometry.location);
                                            
                                            google.maps.event.addListener(marker, 'dragstart', function() {
                                                                          updateMarkerAddress('Finding');
                                                                          });
                                            
                                            google.maps.event.addListener(marker, 'drag', function() {
                                                                          updateMarkerStatus('Moving');
                                                                          updateMarkerPosition(marker.getPosition());
                                                                          updatetscode(marker.getPosition());
                                                                          });
                                            
                                            google.maps.event.addListener(marker, 'dragend', function() {
                                                                          updateMarkerStatus('Stable');
                                                                          geocodePosition(marker.getPosition());
                                                                          map.panTo(marker.getPosition());
                                                                          });
                                            
                                            google.maps.event.addListener(map, 'click', function(e) {
                                                                          updateMarkerPosition(e.latLng);
                                                                          updatetscode(e.latLng);
                                                                          geocodePosition(marker.getPosition());
                                                                          marker.setPosition(e.latLng);
                                                                          map.panTo(marker.getPosition());
                                                                          });
                                            
                                            } else {
                                            alert('Geocode was not successful for the following reason: ' + status);
                                            }
                                            });
                           }
                           
                           function geocodePosition(pos) {
                           geocoder.geocode({
                                            latLng: pos
                                            }, function(responses) {
                                            if (responses && responses.length > 0) {
                                            updateMarkerAddress(responses[0].formatted_address);
                                            } else {
                                            updateMarkerAddress('Cannot determine address at this location.');
                                            }
                                            });
                           }
                           
                           function d2h(d)
                           {
                           return (+d).toString(36).toUpperCase();
                           }
                           
                           function updateMarkerStatus(str) {
                           document.getElementById('markerStatus').innerHTML = str;
                           }
                           
                           function updateMarkerPosition(latLng) {
                           
                           document.getElementById('info').innerHTML = [
                                                                        latLng.lat(),
                                                                        latLng.lng()
                                                                        ].join(', ');
                           }
                           
                           
                           
                           function updatetscode(latLng) {
                           
                           var latitude = latLng.lat();
                           var longitude = latLng.lng();
                           var lati = Math.round(latitude*100);
                           var long = Math.round(longitude*100);
                           
                           document.getElementById('tscode').innerHTML = [
                                                                          d2h(lati),
                                                                          d2h(long)
                                                                          ].join('- ');
                           
                           }
                           
                           function updateMarkerAddress(str) {
                           document.getElementById('address').innerHTML = str;
                           }
                           });
                           
                           
            </script>

    
        <style>
            .map-control {
                background-color: #fff;
                border: 1px solid #ccc;
                box-shadow: 0 2px 2px rgba(33, 33, 33, 0.4);
                font-family: 'Roboto','sans-serif';
                margin: 10px;
                /* Hide the control initially, to prevent it from appearing
                 before the map loads. */
                display: none;
            }
            /* Display the control once it is inside the map. */
            #map .map-control { display: block; }
    
            .selector-control {
                font-size: 14px;
                line-height: 30px;
                padding-left: 5px;
                padding-right: 5px;
            }
        </style>
    </head>
    
    <body>
    
        <!--div id="infoPanel" class="col-md-2">
        
            <div id="panel" align="center"><br/>
            <input style="font-size: 15px; color:#000000" id="city_country" type="textbox" value="26.9400298,75.9253819">
            <input type="button" value="Go!" onclick="codeAddress()" id="button" style="z-index:1;"><br/><br/>
            </div><br/>
        
            <div align="center">
                <b>Current position:</b>
                <div id="info">Click on Go!</div>
            </div>
        
            <div align="center">
                <b>UCP Code:</b>
                <div id="tscode">Click on Go!</div>
            </div>
        
            <div align="center">
                <b>Closest matching address:</b>
                <div id="address">Click on Go!</div>
            </div>
        
            <div align="center">
                <br/><br/>____________<br/><br/>
            </div>
        
            <div id="coderev" align="center">
             <input style="font-size: 15px; width: 50px;" id="ipcode1" type="textbox" value="FYR">
             <input style="font-size: 15px; width: 50px;" id="ipcode2" type="textbox" value="CSJ">
             <input type="button" value="Convert Back" onclick="back()" id="button">
             <br/><br/>
             </div>
        
             <div align="center">
             <b>Corresponding Position:</b>
             <div id="copo">26.93, 75.92</div><br/>
             </div>
             <div id="style-selector-control"  class="map-control" style="z-index:2;">
                 <select id="style-selector" class="selector-control">
                     <option value="default">Default</option>
                     <option value="night">Night mode</option>
                     <option value="retro" selected="selected">Retro</option>
                 </select>
             </div>
        </div-->
        
        <div class="col-md-10" style="background-color:#000000;">
            <div id="map" style="height:100%;width:100%"></div>
        </div>
    </body>
</html>
